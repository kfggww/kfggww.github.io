<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content=""
  />
  
    
      <title>Xv6 Debug | junan&#39;s blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  <link rel="stylesheet" href="/css/font.css"/>
  <link rel="stylesheet" href="/css/smigle.css"/>
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <header>
  <div id="brand">
    <a class="icon-link" href="http://kfggww.github.io/">
      <img
        class="icon"
        src="/images/brandIcon.svg"
      />
    </a>
    <div class="text">
      <a href="http://kfggww.github.io/"><h1>junan&#39;s blog</h1></a>
      <h3>What I cannot create I do not understand</h3>
    </div>
  </div>
  <nav>
    
  </nav>
  <hr />
</header>

    <div id="content">
      
  <main>
    <article>
      <h1>Xv6 Debug</h1>
      <div class="post-meta">
  <strong>
    <span>Posted on</span>
    <time>2022-03-27 09:23:24</time>
    
    
  </strong>
  <span> • 77 words</span>
  <span> • 1 minute read</span>
  
  
</div>

      <div><h2 id="1-概述">1. 概述</h2>
<p>xv6是MIT6.S081操作系统课程使用的一个教学性质的OS, 提供了针对OS不同模块的实验. 本文仅讨论支持RISC-V指令集的xv6, 调试xv6内核代码使用qemu + gdb的方式, xv6的代码使用RISC-V汇编和c语言编写, 整个工程的构建使用Makefile管理, 并且使用链接脚本控制kernel文件的链接过程, 因此, 为了能够顺利完成之后的代码实验, 需要掌握的前置知识包括但不限于:</p>
<ul>
<li>RISC-V指令集. 非特权指令, 特权指令, trap, plic, &hellip;</li>
<li>c语言基础.</li>
<li>qemu仿真器. 启动/退出, 关键启动参数的作用</li>
<li>gdb基本调试. 断点, 查看变量/内存/寄存器, gdb脚本, 执行流控制, 多线程程序debug, &hellip;</li>
<li>gnu make工具.</li>
<li>链接脚本基本概念. 完成实验不必自己写链接脚本, 但对于理解kernel文件在内存中布局很有帮助.</li>
</ul>
<p>当然, 不必在精通了全部上述所列内容之后再开始对xv6的学习. 对一些知识先有一个大概的了解即可, 如果在完成实验时遇到了阻碍再去专门仔细研究, 可能反而会理解得更深入一些.</p>
<h2 id="2-环境准备">2. 环境准备</h2>
<h2 id="3-调试xv6">3. 调试xv6</h2>
<p>使用qemu启动xv6之后, init进程会fork出一个shell进程, 当用户通过终端输入字符时, 输入的字符会回显出来, 输入结束敲击回车, shell进程会解析并执行用户输入的命令, 接下来就使用gdb+qemu对这个过程进行调试.</p>
<ul>
<li>首先, 启动一个终端, 并启动qemu等待gdb连接.</li>
<li>开启另一个终端, 使用gdb连接qemu.</li>
<li>xv6内核完成初始化之后会跳转到第一个用户进程init, init进程首先尝试打开&quot;console&quot;文件, 若文件不存在则创建一个并打开, 这个打开的&quot;console&quot;文件在init进程中的文件描述符为0, 之后发起两次dup调用, 此时init进程中打开的文件描述符有0, 1, 2, 并且都指向&quot;console&quot;文件. 接下来init进程会fork出shell进程, shell进程负责解析并执行用户命令, init进程则一直等待fork出的shell进程退出, shell进程的文件描述符0, 1, 2继承自init进程.</li>
<li>用户通过终端输入命令时, 会通过串口将字符发送到xv6内核, 并触发xv6的串口中断.</li>
</ul>
<h2 id="4-参考文献">4. 参考文献</h2>
</div>
    </article>
  </main>

    </div>
    <footer>
  <hr />
  
  <p class="copyright">
    Copyright © 2022
    <a href="http://kfggww.github.io/"><strong>Blog Author</strong></a>.
    This work is licensed under the
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.
  </p>
  <p class="builtWith">
    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    using the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>,
    which was influenced by the theme
    <a href="https://github.com/sumnerevans/smol">smol</a>.
  </p>
</footer>

  </body>
</html>
